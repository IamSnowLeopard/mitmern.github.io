<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bus Route</title>

    <!--Add Google Maps library and Styles-->
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlWk37rgb1P62pjuIjsmMhdjlOetQNO0M&callback=initMap">
    </script>

    <style>
        #map {
            height: 100%;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        .map-overlay{
            position: absolute;
            left: 0;
            padding: 10px;
        }
    </style>
</head>

<body>
  <div id="map"></div>
  <div class="map-overlay top">
    <button style="font-size: 2em;" onclick="move()">
        Show stops between MIT and Harvard
     </button>
</div>

<!--initialize the map on Boston-->
<script>
    let map;
    let marker;
   // let busStops = [];

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 42.358862, lng: -71.09152 },
            zoom: 14,
    });

    //add a marker
    marker = new google.maps.Marker({
        position: { lat: 42.357575, lng: -71.092761 },
        map: map,
    });
}

    //get a hold of the busstops in a programmatic way
   async function getBusLocations(){
    let url = 'https://api-v3.mbta.com/vehicles?filter[route]=1&include=trip';
    let response = await fetch(url);
    let json = await response.json();
    return json.data.map(bus => ({lat: bus.attributes.latitude, lng: bus.attributes.longitude}));
   }

   //trigger the marker movement
   async function run() {
        let locations = await getBusLocations();
        console.log(new Date());
        console.log(locations);

        //timer
        setTimeout(run, 15000);
   }

   run();
</script>

</body>
</html>