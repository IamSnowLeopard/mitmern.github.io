<!DOCTYPE html>
<html lang="en">
<head>
    <title>NY Metro Bus Route</title>
</head>

<body>
	<div id="map" style="width:1920px; height:768px"></div>
 	
	<!--Add Google Maps library and Styles-->
 	<script async defer 
		src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlWk37rgb1P62pjuIjsmMhdjlOetQNO0M&callback=initMap">
	</script>

	<!--Initialize Map -->
	<script>
		let map;

    	function initMap(){
	    	map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: { lat: 40.7569607, lng: -73.9904931 }
            });
    	

		// Add markers to map
			getBusLocations().then(locations => {
    			locations.forEach(location => {
        			new google.maps.Marker({
            			position: location,
            			map: map,
            			icon: {
                			path: google.maps.SymbolPath.CIRCLE,
                			scale: 15
            			}
        			});
    			});
			});
		}

		// Make API call to MTA SIRI VehicleMonitoring API to request information about vehicles on a certain route
		async function getBusLocations(){
			let url = 'https://bustime.mta.info/api/siri/vehicle-monitoring.json?key=34316322-b8d7-4711-bb94-c51a03ba6320&version=2&OperatorRef=MTA&LineRef=MTA%20NYCT_M4';	
			let response = await fetch(url);
			let json = await response.json();

		// Extract vehicle locations from the JSON response
		let vehicleActivities = json.Siri.ServiceDelivery.VehicleMonitoringDelivery[0].VehicleActivity;
    	return vehicleActivities.map(activity => {
        	return {
            	lat: activity.MonitoredVehicleJourney.VehicleLocation.Latitude,
            	lng: activity.MonitoredVehicleJourney.VehicleLocation.Longitude
        	};
    	});
	}

	</script>
</body>
</html>